<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head data-vp="http://{{host}}/portalProject/">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
    <title>微课中心</title>

    <link href="css/base.css" rel="stylesheet" />
    <link href="css/profession.css" rel="stylesheet" />
    <link href="css/yui.css" rel="stylesheet" />
    <style>
    	.header-logo{width:620px;height:100px;}
		.header-logo img{width:100px;vertical-align: middle;}
		.header-logo h2{width:500px;}
    </style>
</head>
<body style="background-color: #fff;">
    <div class="header">
        <div class="header-inner clefix">
            <span class="header-logo" id="logo">
                <img src="/portalProject/themes/sta_page/img/smile.jpg" width="353" height="100">
                 <h2>铁道信号自动控制专业教学资源库</h2>
            </span>
            <div class="login-wrapper">
                <div class="login-inner">
                    <a href="/portal" class="login-link" id="login-btn">返回首页</a>

                </div>
                <div class="personal-center" style="display: none;">
                    <div class="center-group">
                        <a href="javascript:;" class="center-link">消息(2)</a>
                        <a href="javascript:;" class="center-link">个人中心</a>
                        <a href="javascript:;" class="center-link">退出</a>
                    </div>
                </div>
            </div>
            <div class="header-nav">
              <ul class="nav-group">
                    <li class="nav-i"><a href="index.html" class="nav-link ">专业首页</a>
                    </li>
                    <li class="nav-i"><a href="major_garden.html" class="nav-link">专业园地</a>
                    </li>
                    <li class="nav-i"><a href="course.html" class="nav-link">课程中心</a>
                    </li>
                    <li class="nav-i"><a href="smallcourse.html" class="nav-link current">微课中心</a>
                    </li>                   
                     <li class="nav-i"><a href="material.html" class="nav-link">素材中心</a>
                    </li>
                    <li class="nav-i"><a href="industry_resources.html" class="nav-link">行业资源</a>
                    </li>
                    <li class="nav-i"><a href="corporate_training.html" class="nav-link">企业培训</a>
                    </li>
                    <li class="nav-i"><a href="skill_textual_research.html" class="nav-link">技能考证</a>
                    </li>
                    <li class="nav-i"><a href="yidaiyilu.html" class="nav-link">"一带一路"</a>
                    </li>
                    </li>
                    <li class="nav-i"><a href="practical_training_base.html" class="nav-link">实训基地</a>
                    </li>
                    <li class="nav-i"><a href="skill_practice.html" class="nav-link">技能训练</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="wrapper">
        <div class="wrapper-inner">
            <input type="hidden" name="projectId" value="4-s5ajgkdzppyxfogizing" />
            <input type="hidden" name="schoolId" />
            <input type="hidden" name="page" value="1" />
            <input type="hidden" name="searchName" />
            <input type="hidden" name="tag" />
            <div class="yui3-g">
                <div class="yui3-u-1-4">
                    <div class="sidebar" style="padding-left: 0;">
                        <div class="widgets widegets-search clefix">
                            <div class="search-inner clefix">
                                <input type="text" value="" name="couse_name" class="search-input">
                            </div>
                            <button type="button" class="search-btn" id="searchCourseName"></button>
                        </div>

                        <div class="widgets widegets-list">
                            <h3>学校•企业</h3>
                            <ul class="art-list" id="school_enterprise_html">
                            </ul>
                            <div class="more-school" id="more-school"><a href="#">选择其他学校.企业</a></div>
                        </div>

                        <div class="widgets widegets-list">
                            <h3>课程标签</h3>
                            <div class="tags" id="tag_html">
                            </div>
                        </div>

                    </div>
                </div>
                <div class="yui3-u-3-4">
                    <div class="primary" style="padding-left: 20px; padding-right: 0;">
                        <ul class="curriculum clefix" id="smallcourse_html">
                        </ul>
                        <div class="section-fouth pagination" id="pagination" style="text-align: center;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  <div class="footer">
        <div class="footer-inner">
            <div class="footer-left" id="footerLeft">
            </div>
            <div class="footer-right">
                <h3 class="footer-logo">&nbsp;</h3>
                <div class="footer-text">
                    <p>
                       <a href='/portal/platform?page=1' target="_blank">平台简介</a>&nbsp;|&nbsp;
         
                        <a href='/portal/platform?page=2' target="_blank">知识产权</a>&nbsp;|&nbsp;
         
                        <a href='/portal/platform?page=3' target="_blank">免责声明</a>&nbsp;|&nbsp;
         
                        <a href='/portal/platform?page=4' target="_blank">意见反馈</a>&nbsp;|&nbsp;
         
                        <a href='/portal/platform?page=5' target="_blank">联系我们</a>
                    </p>
                </div>

            </div>
            <div class="footer-copyright" style="padding-left: 100px;">
                <span>Copyright©www.icve.com.cn</span>
                <a href="http://www.miitbeian.gov.cn/" class="copyright-ICP">京ICP备12020869-19</a>
            </div>
        </div>
    </div>
    <script id="smallcourse" type="text/html">
        <!if(smallcourse_hot.length==0){!>
        没有符合条件的信息
        <!}!>
    <! for(var i = 0; i < smallcourse_hot.length; i++) { !>
              <li>
                  <div class="curriculum-list">
                      <div class="pic">
                          <a href="/portal/weikeinfo?weikeid=<!=smallcourse_hot[i].id!>" target="_blank"><!if(smallcourse_hot[i].Cover==""){!>
                              <img src="/portalProject/themes/sta_page/img/no_thumbnail.jpg" width="218" height="122"></a>
                          <!}else{!>
                              <img src="<!=smallcourse_hot[i].Cover !>" width="218" height="122"></a>
                          <!}!>
                      </div>
                      <div class="curriculum-info clefix">
                          <div class="info-left">
                              <p><a href="/portal/weikeinfo?weikeid=<!=smallcourse_hot[i].id!>" title="<!=smallcourse_hot[i].courseName!>">
                                    <!if(smallcourse_hot[i].courseName.length>8){!>
                                   <!=smallcourse_hot[i].courseName.substr(0,8)+"..."!>
                                  <!}else{!>
                                  <!=smallcourse_hot[i].courseName!>
                                  <!}!>
                                 </a>

                              </p>
                              <p class="school">
                                  <!if(smallcourse_hot[i].displayname==""){!>
                                    暂无
                                   <!}else{!>
                                 <!=smallcourse_hot[i].displayname!>
                                 <!}!>
                              </p>
                          </div>
                          <div class="info-right">
                              <p class="number-green"><!=smallcourse_hot[i].peoplecount!></p>
                              <p class="time-green" title="<!=smallcourse_hot[i].time!>"><!=smallcourse_hot[i].time!></p>
                          </div>
                      </div>
                  </div>
              </li>
        <! } !> 
    </script>

    <script id="school_enterprise" type="text/html">
        <! for(var i = 0; i < school_enter.length; i++) { !>
       <li><a href="#" data-id="<!=school_enter[i].id!>" title="<!=school_enter[i].name!>">
             <!if(school_enter[i].name.length>10){!>
            <!=school_enter[i].name.substr(0,10)+"..."!>
           <!}else{!>
           <!=school_enter[i].name!>
           <!}!>
           <span style="margin-left: 20px; color: red;">(<!=school_enter[i].coursecount!>)</span></a></li>
        <! } !> 
    </script>

 <script id="page_html" type="text/html">
        <!if(totalPageCount>1){!>
        <!if(pageCurrent!=1){!>
         <a href="?page=<!=pageCurrent-1!>" data-page="<!=pageCurrent-1!>" title="上一页" class="prev">上一页</a>
        <! } !> 
          <!if(totalPageCount<8){!>
             <! for(var i = 1; i <totalPageCount+1; i++) { !>
              <!if(pageCurrent==i){!>
               <a href="?page=<!=i!>" data-page="<!=i!>" class="current"><!=i!></a>
              <!}else{!>
               <a href="?page=<!=i!>" data-page="<!=i!>"><!=i!></a>
              <! } !> 
             <! } !> 
			
        <!}else{!>
		    <!if(pageCurrent<5){!>
		     <! for(var i = 1; i <7; i++){ !>
              <!if(pageCurrent==i){!>
               <a href="?page=<!=i!>" data-page="<!=i!>" class="current"><!=i!></a>
              <!}else{!>
               <a href="?page=<!=i!>" data-page="<!=i!>"><!=i!></a>
              <! } !> 
             <! } !> 
			 <span><!='\.\.\.'!></span>
			 <a href="?page=<!=totalPageCount!>" data-page="<!=totalPageCount!>"><!=totalPageCount!></a>
			<!}else if(pageCurrent>totalPageCount-4){!>
			  <a href="?page=<!=1!>" data-page="<!=1!>"><!=1!></a>
              <span><!='\.\.\.'!></span>
			  <! for(var i = pageCurrent-2; i <totalPageCount; i++){ !>
              <!if(pageCurrent==i){!>
               <a href="?page=<!=i!>" data-page="<!=i!>" class="current"><!=i!></a>
              <!}else{!>
               <a href="?page=<!=i!>" data-page="<!=i!>"><!=i!></a>
              <! } !> 
             <! } !> 
			   <!if(pageCurrent==totalPageCount){!>
               <a href="?page=<!=totalPageCount!>" data-page="<!=totalPageCount!>" class="current"><!=totalPageCount!></a>
              <!}else{!>
               <a href="?page=<!=totalPageCount!>" data-page="<!=totalPageCount!>"><!=totalPageCount!></a>
              <! } !> 
			<!}else{!>
			  <!if(pageCurrent==1){!>
               <a href="?page=<!=1!>" data-page="<!=1!>" class="current"><!=1!></a>
              <!}else{!>
               <a href="?page=<!=1!>" data-page="<!=1!>"><!=1!></a>
              <! } !> 
			   <span><!='\.\.\.'!></span>
			    <! for(var i = pageCurrent-2; i <pageCurrent+3; i++){ !>
              <!if(pageCurrent==i){!>
               <a href="?page=<!=i!>" data-page="<!=i!>" class="current"><!=i!></a>
              <!}else{!>
               <a href="?page=<!=i!>" data-page="<!=i!>"><!=i!></a>
              <! } !> 
             <! } !> 
			 <span><!='\.\.\.'!></span>
			 <a href="?page=<!=totalPageCount!>" data-page="<!=totalPageCount!>"><!=totalPageCount!></a>
			 
			<! } !> 
		  
		
		<! } !> 
        
         <!if(pageCurrent!=totalPageCount){!>
          <a href="?page=<!=pageCurrent+1!>" data-page="<!=pageCurrent+1!>" title="下一页" class="next">下一页</a>
        <! } !> 
    <! } !> 
    </script>

    <script id="tag" type="text/html">
        <! for(var i = 0; i < tag.length; i++) { !>
         <a href="#"><!=tag[i]!></a>
        <! } !> 
    </script>

    <script id="link_html" type="text/html">
        <! for(var i = 0; i < link.length; i++) { !>
             <a href="<!=link[i].url!>" target="_blank"><!=link[i].name!></a>
        <! } !> 
    </script>

     <script src="/portalProject/js/common/jquery.js"></script>
    <script src="/portalProject/js/common/showDialog.js"></script>
    <script src="/portalProject/js/interface/Sub_Project_Interface.js"></script>
    <script src="/portalProject/js/interface/Sub_Project_Index.js"></script>
    <script src="/portalProject/js/interface/BaiduTemplate.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            $('input[name=projectId]').val(jQuery.query.get(projectId).projectId);
            //使用baidu.template命名空间
            var bt = baidu.template;

            //可以设置分隔符
            bt.LEFT_DELIMITER = '<!';
            bt.RIGHT_DELIMITER = '!>';

            //可以设置输出变量是否自动HTML转义
            //bt.ESCAPE = false;

            //专业Id
            var projectId = $('input[name=projectId]').val();

            //分页page
            var page = $('input[name=page]').val();

            //微课start
            var data = {
                projectId: projectId,  //传递的参数
                hot: false,
                page: page,
                pagesize: 9,
                order: 'asc'
            };

            var smallCourseList = function (data) {
                var get_smallcourse = sub_project.smallcourse(data);

                var smallcourse_hot = {
                    smallcourse_hot: get_smallcourse.smallcourse.smallcourse
                };
                var smallcourse_html = bt('smallcourse', smallcourse_hot);
                document.getElementById('smallcourse_html').innerHTML = smallcourse_html;//渲染

                //分页数据
                var pagination = {
                    pageCurrent: parseInt(get_smallcourse.pageCurrent),
                    totalPageCount: get_smallcourse.totalPageCount
                }

                //绑定所属分页
                var page_html = bt('page_html', pagination);
                document.getElementById('pagination').innerHTML = page_html;//渲染
            }

            //友情链接
            var get_friendLink = sub_project.get_footer(projectId).data;
            var link = {
                link: get_friendLink
            }
            var link_htmls = bt('link_html', link);
            document.getElementById('footerLeft').innerHTML = link_htmls;//渲染

            //获取logo  start
            var logos = sub_project.getLogo(projectId);
            var projectname=logos.projectName+"专业教学资源库";
            $("#logo img").attr("src", logos.logoUrl);
            $("#logo h2").attr("title",logos.projectName);
            $("#logo h2").text(projectname);
            //end

            //课程标签 start
            var get_tag = sub_project.course_tag(projectId, 0, 2,9);
            var tag = {
                tag: get_tag.tag
            }
            var tag_html = bt('tag', tag);
            document.getElementById('tag_html').innerHTML = tag_html;//渲染
            //end

            //学校·企业获取课程值
            var clickGetData = function (type) {
                var schoolOfData = {
                    projectId: projectId,
                    hot: false,
                    pagesize: 9,
                    page: 1,
                    school_enter: $("input[name=schoolId]").val(),
                    search_name: $("input[name=searchName]").val(),
                    tag: $("input[name=tag]").val(),
                    type: type == "" ? false : true,
                    classify: 0
                }
                smallCourseList(schoolOfData);
            }

            //学校·企业 start
            var get_schoolEnter = sub_project.school_enterprise(projectId, 2, 0);
            var school_enter = {
                school_enter: get_schoolEnter.data.schoolEnter
            }
            var school_enterprise_html = bt('school_enterprise', school_enter);
            document.getElementById('school_enterprise_html').innerHTML = school_enterprise_html;//渲染
            // end

            //学校企业查询
            $("#school_enterprise_html a").click(function () {
                $("input[name=tag]").val("");
                $("input[name=schoolId]").val("");
                //每次点击重新赋值数据，避免分页过后查询的是全部信息
                $("input[name=schoolId]").val($(this).data("id"));
                var schoolOfData = {
                    projectId: projectId,
                    hot: false,
                    pagesize: 5,
                    page: 1,
                    school_enter: $("input[name=schoolId]").val(),
                    type: true,
                    classify: 1
                }
                smallCourseList(schoolOfData);
                return false;
            });

            //绑定分页
            $('.pagination').on('click', 'a', function () {
                page = $(this).attr("data-page");
                $('.pagination a').removeClass('current');
                $(this).addClass('current');

                //加其他参数
                var paginationData = {
                    projectId: projectId,
                    hot: false,
                    pagesize: 9,
                    page: page,
                    tag: $("input[name=tag]").val(),
                    school_enter: $("input[name=schoolId]").val(),
                    search_name: $("input[name=searchName]").val()
                }
                smallCourseList(paginationData);
                return false;
            });

            //右侧搜索框
            $("#searchCourseName").click(function () {
                $("input[name=searchName]").val($("input[name=couse_name]").val());
                $("input[name=schoolId]").val("");
                $("input[name=tag]").val("");
                clickGetData(false);
            });

            //点击标签查询
            $("#tag_html a").click(function () {
                $("input[name=tag]").val($(this).text());
                $("input[name=schoolId]").val("");
                $("input[name=searchName]").val("");
                clickGetData(false);
                return false;
            });

            //学校·企业加载更多
            $('#more-school').showDialog({
                id: 'more_school',//dialogId（自定义）
                type: 'get',
                title: '学校·企业列表',
                data: { projectId: projectId, type: 2, classify: 0 },
                inputName: 'key',
                dataURL: $("head").data("vp").replace("{{host}}", window.location.host) + 'ajax-portalpoject-getSchoolEnterprise_More?page={autoPage}',
                searchURL: $("head").data("vp").replace("{{host}}", window.location.host) + 'ajax-portalpoject-getSchoolEnterprise_More?page={autoPage}',
                before: function () { },
                callback: function () {
                    var _this = this;
                    //点击dialog获取课程值
                    $("#more_school li a").click(function () {
                        $("input[name=schoolId]").val($(this).data("id"));
                        clickGetData();
                        _this.dialog.hide();
                    });

                }
            });

            //微课初始化
            smallCourseList(data);

        });
    </script>
</body>
</html>
